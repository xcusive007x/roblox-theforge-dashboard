<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roblox Inventory Dashboard</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #1e1e1e; color: white; display: flex; justify-content: center; padding-top: 50px; }
        
        /* Layout */
        .container { 
            background-color: #2c2c2c; 
            padding: 30px; 
            border-radius: 15px; 
            width: 550px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); 
            position: relative; 
        }
        
        /* Status Badge */
        .status-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            display: flex;
            align-items: center;
            background-color: #444; 
            transition: background-color 0.3s ease;
        }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background-color: white; margin-right: 6px; }

        /* Profile */
        .profile { text-align: center; margin-bottom: 20px; }
        .profile img { 
            width: 100px; height: 100px; 
            border-radius: 50%; border: 3px solid #00aaff; object-fit: cover; 
            background-color: #1e1e1e;
        }
        
        /* Stats */
        .stats { display: flex; justify-content: space-between; margin-bottom: 20px; background: #383838; padding: 15px; border-radius: 8px; }
        .stat-box { text-align: center; flex: 1; border-right: 1px solid #555; }
        .stat-box:last-child { border-right: none; }
        .stat-label { font-size: 0.9em; color: #aaa; margin-bottom: 5px; }
        .stat-val { font-size: 1.0em; font-weight: bold; color: #ffd700; white-space: nowrap; }
        
        /* List */
        h3 { border-bottom: 1px solid #555; padding-bottom: 10px; margin-top: 20px; }
        .item-list { list-style: none; padding: 0; max-height: 300px; overflow-y: auto; }
        .item-list li { background: #444; margin: 5px 0; padding: 10px; border-radius: 5px; display: flex; align-items: center; }
        .dot { height: 10px; width: 10px; background-color: #00ff88; border-radius: 50%; margin-right: 10px; }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #333; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
    </style>
</head>
<body>
    
<div class="container">
    <div id="statusBadge" class="status-badge">
        <span class="status-dot"></span>
        <span id="statusText">Checking...</span>
    </div>

    <div class="profile">
        <img id="avatar" src="" onerror="this.src='https://tr.rbxcdn.com/53eb9b17fe1432a809c73a13889b5006/150/150/Image/Png'">
        <h2 id="username">Loading...</h2>
    </div>

    <div class="stats">
        <div class="stat-box">
            <div class="stat-label">Level</div>
            <div id="level" class="stat-val">-</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">Gold</div>
            <div id="gold" class="stat-val">-</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">Capacity</div>
            <div id="capacity" class="stat-val">-</div>
        </div>
    </div>

    <h3>Inventory (Stash)</h3>
    <ul id="itemList" class="item-list"></ul>
</div>

<script>
    function updateStatus(state) {
        const badge = document.getElementById('statusBadge');
        const text = document.getElementById('statusText');
        const dot = badge.querySelector('.status-dot');

        if (state === 'online') {
            badge.style.backgroundColor = 'rgba(0, 255, 136, 0.2)';
            badge.style.border = '1px solid #00ff88';
            text.innerText = 'In Game';
            text.style.color = '#00ff88';
            dot.style.backgroundColor = '#00ff88';
        } else if (state === 'offline') {
            badge.style.backgroundColor = 'rgba(255, 50, 50, 0.2)';
            badge.style.border = '1px solid #ff3232';
            text.innerText = 'Disconnected';
            text.style.color = '#ff3232';
            dot.style.backgroundColor = '#ff3232';
        } else {
            badge.style.backgroundColor = '#333';
            badge.style.border = '1px solid #666';
            text.innerText = 'Server Error';
            text.style.color = '#aaa';
            dot.style.backgroundColor = '#aaa';
        }
    }

    async function fetchData() {
        try {
            const response = await fetch('/get-data');
            const data = await response.json();

            // 1. Status
            updateStatus(data.status === "Online" ? 'online' : 'offline');

            // 2. ข้อมูลตัวหนังสือ
            document.getElementById('username').innerText = data.username;
            document.getElementById('level').innerText = data.level;
            document.getElementById('gold').innerText = data.gold;
            document.getElementById('capacity').innerText = data.capacity || "N/A";

            // 3. รูปภาพ (Server ส่ง URL มาให้แล้ว เอาไปใช้ได้เลย)
            if (data.avatarUrl) {
                document.getElementById('avatar').src = data.avatarUrl;
            }

            // 4. Inventory
            const list = document.getElementById('itemList');
            list.innerHTML = ''; 
            
            if (data.items) {
                data.items.forEach(item => {
                    const li = document.createElement('li');
                    li.style.display = "flex";
                    li.style.justifyContent = "space-between";
                    li.style.alignItems = "center";
                    li.innerHTML = `
                        <div style="display:flex; align-items:center;">
                            <span class="dot"></span>
                            <span style="font-weight:bold;">${item.name}</span>
                        </div>
                        <span style="background:#555; padding:2px 8px; border-radius:10px; font-size:0.9em; color:#00ff88;">
                            ${item.qty}
                        </span>
                    `;
                    list.appendChild(li);
                });
            }

        } catch (error) {
            console.error('Error fetching data:', error);
            updateStatus('error');
        }
    }

    setInterval(fetchData, 500);
    fetchData();
</script>

</body>
</html>
